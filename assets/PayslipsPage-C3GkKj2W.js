import{c as $,u as A,r as n,j as e,F as I,_ as B}from"./index-CPj150BD.js";/* empty css                   */import{C as U}from"./clock-5BlVpHo7.js";const Y=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Z=$("download",Y),q=[{monthOffset:-4,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-4,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:-3,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-3,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:-2,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-2,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:-1,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-1,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:0,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:0,type:"timesheet",document:"stundennachweis.pdf"}],G={payslips:q},H=s=>{const p=new Date;return new Date(p.getFullYear(),p.getMonth()+s,1)};function X(){const{t:s}=A("app"),p=n.useMemo(()=>G.payslips.map(a=>({date:H(a.monthOffset).toISOString().split("T")[0],type:a.type,document:a.document})),[]),N=t=>{const a=new Date(t),o=a.getDate().toString().padStart(2,"0"),m=(a.getMonth()+1).toString().padStart(2,"0"),k=a.getFullYear();return`${o}.${m}.${k}`},E=t=>s(t==="payslip"?"payslips.payslip":"payslips.timesheet"),F=t=>`/toepfer-pwa-prototyp/${t}`,[i,S]=n.useState(null),[O,P]=n.useState(!1),[x,C]=n.useState(null),[b,c]=n.useState(1),[R,w]=n.useState([]),[D,r]=n.useState(!0),j=n.useRef(null),d=n.useRef(null),u=n.useRef(0);n.useEffect(()=>{(async()=>{if(!i){w([]),r(!0),c(1);return}const a=++u.current;C(null),P(!0),w([]);try{const o=F(i),m=await B(()=>import("./pdf-Dv71ODxn.js"),[]);m.GlobalWorkerOptions.workerSrc=new URL("/toepfer-pwa-prototyp/assets/pdf.worker.min-Cpi8b8z3.mjs",import.meta.url).toString();const v=await m.getDocument(o).promise;if(a!==u.current)return;const V=v.numPages,M=[];let h=b;if(D&&j.current){const y=(await v.getPage(1)).getViewport({scale:1}),l=j.current.clientWidth;h=Math.max(.3,Math.min(3,l/y.width)),r(!1),Math.abs(h-b)>.01&&c(h)}for(let f=1;f<=V;f++){const y=await v.getPage(f),l=y.getViewport({scale:h}),g=document.createElement("canvas");g.width=l.width,g.height=l.height;const L=g.getContext("2d");if(!L)throw new Error("Canvas context not available");const W={canvasContext:L,viewport:l};await y.render(W).promise,M.push(g.toDataURL())}a===u.current&&w(M)}catch(o){console.error("PDF render error",o),C(s("payslips.loadError"))}finally{a===u.current&&P(!1)}})()},[i,b,D,s]),n.useEffect(()=>{const t=document.querySelector('meta[name="viewport"]');if(i){if(t){d.current=t.getAttribute("content");const o=(d.current||"width=device-width, initial-scale=1.0").replace(/user-scalable=no,?\s*/i,"").replace(/maximum-scale=1\.0,?\s*/i,"")+", maximum-scale=5.0, user-scalable=yes";t.setAttribute("content",o)}}else t&&d.current&&t.setAttribute("content",d.current)},[i]);const _=()=>{r(!1),c(t=>t*1.15)},z=()=>{r(!1),c(t=>Math.max(.2,t/1.15))},T=()=>{r(!0),c(1)};return e.jsxs("div",{className:"page-container",children:[e.jsx("header",{className:"page-header",children:e.jsx("h1",{className:"page-title",children:s("payslips.title")})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("payslips.date")}),e.jsx("th",{children:s("payslips.description")}),e.jsx("th",{children:s("payslips.document")})]})}),e.jsx("tbody",{children:p.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"date-cell",children:N(t.date)}),e.jsx("td",{className:"description-cell",children:e.jsxs("div",{className:"description-with-icon",children:[t.type==="payslip"?e.jsx(I,{size:18,className:"file-icon"}):e.jsx(U,{size:18,className:"file-icon"}),e.jsx("span",{children:E(t.type)})]})}),e.jsx("td",{className:"document-cell",children:e.jsxs("button",{type:"button",className:"download-button","aria-label":s("payslips.open"),onClick:()=>S(t.document),children:[e.jsx(Z,{size:18}),e.jsx("span",{className:"download-text",children:s("payslips.open")})]})})]},a))})]})}),i&&e.jsxs("div",{className:"pdf-overlay",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"pdf-toolbar",children:[e.jsx("span",{className:"pdf-title",children:s("payslips.documentViewerTitle")}),e.jsxs("div",{className:"pdf-controls","aria-label":"PDF controls",children:[e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:z,"aria-label":s("payslips.zoomOut"),children:s("payslips.zoomOut")}),e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:_,"aria-label":s("payslips.zoomIn"),children:s("payslips.zoomIn")}),e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:T,"aria-label":s("payslips.fitWidth"),children:s("payslips.fitWidth")}),e.jsx("button",{type:"button",className:"pdf-close-button","aria-label":s("payslips.closeDocument"),onClick:()=>S(null),children:s("payslips.closeDocument")})]})]}),e.jsxs("div",{className:"pdf-frame-wrapper",ref:j,children:[O&&e.jsx("div",{className:"pdf-status",children:s("payslips.loading")}),x&&e.jsx("div",{className:"pdf-error",children:x}),!O&&!x&&R.map((t,a)=>e.jsx("img",{src:t,alt:`${s("payslips.documentViewerTitle")} - Page ${a+1}`,style:{display:"block",margin:"0 auto 1rem"}},a))]})]})]})}export{X as default};

import{c as h,u as _,r as s,j as t}from"./index-CMvrDxtj.js";/* empty css                   */import{S as z}from"./send-DF2-G0Ob.js";const P=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],$=h("camera",P);const L=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],A=h("image",L);const F=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],W=h("user",F);const B=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],O=h("users",B);function V({onKeyboardVisibilityChange:g}){const{t:a}=_("app"),[l,x]=s.useState("supervisor"),[d,v]=s.useState(""),[f,i]=s.useState([]),[m,j]=s.useState(!1),y=s.useRef(null),N=s.useRef(null),[C,k]=s.useState(!1),[o,b]=s.useState(null),n=s.useRef(null);s.useEffect(()=>{i(l==="supervisor"?[{id:"1",sender:"other",senderName:"Hr. Schmidt",text:"Guten Morgen! Wie kann ich Ihnen helfen?",timestamp:new Date(Date.now()-36e5)},{id:"2",sender:"user",text:"Ich hätte eine Frage zum Dienstplan nächste Woche.",timestamp:new Date(Date.now()-3e6)}]:[{id:"1",sender:"other",senderName:"Maria",text:"Hallo Team! Wer kann morgen die Schicht übernehmen?",timestamp:new Date(Date.now()-72e5)},{id:"2",sender:"other",senderName:"Thomas",text:"Ich könnte ab 14 Uhr einspringen.",timestamp:new Date(Date.now()-54e5)}])},[l]),s.useEffect(()=>{M()},[f]),s.useEffect(()=>{n.current&&o&&(n.current.srcObject=o,n.current.play().catch(()=>{}))},[o]),s.useEffect(()=>()=>{o?.getTracks().forEach(e=>e.stop())},[o]);const M=()=>{N.current?.scrollIntoView({behavior:"smooth",block:"nearest"})},w=()=>{if(!d.trim())return;const e={id:Date.now().toString(),sender:"user",text:d,timestamp:new Date};i(r=>[...r,e]),v(""),setTimeout(()=>{const r={id:(Date.now()+1).toString(),sender:"other",senderName:l==="supervisor"?"Hr. Schmidt":"Team Mitglied",text:a("chat.autoResponse"),timestamp:new Date};i(c=>[...c,r])},2e3)},S=e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),w())},I=e=>{const r=e.target.files?.[0];if(!r)return;j(!0);const c=new FileReader;c.onload=()=>{const u={id:Date.now().toString(),sender:"user",text:"",imageUrl:c.result,timestamp:new Date};i(p=>[...p,u]),j(!1)},c.readAsDataURL(r)},U=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert(a("chat.cameraNotSupported"));return}const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});b(e),k(!0)}catch(e){console.error("Camera error:",e),alert(a("chat.cameraError"))}},D=()=>{o?.getTracks().forEach(e=>e.stop()),b(null),k(!1)},E=()=>{if(!n.current)return;const e=document.createElement("canvas");e.width=n.current.videoWidth,e.height=n.current.videoHeight,e.getContext("2d")?.drawImage(n.current,0,0);const c=e.toDataURL("image/jpeg"),u={id:Date.now().toString(),sender:"user",text:"",imageUrl:c,timestamp:new Date};i(p=>[...p,u]),D()},R=()=>{g?.(!0)},T=()=>{g?.(!1)},H=e=>e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return t.jsxs("div",{className:"page-container chat-page-container",children:[t.jsx("header",{className:"page-header",children:t.jsx("h1",{className:"page-title",children:a("chat.title")})}),t.jsxs("div",{className:"chat-container",children:[t.jsxs("div",{className:"chat-tabs",children:[t.jsxs("button",{type:"button",className:`chat-tab ${l==="supervisor"?"active":""}`,onClick:()=>x("supervisor"),children:[t.jsx(W,{size:18}),t.jsx("span",{children:a("chat.supervisor")})]}),t.jsxs("button",{type:"button",className:`chat-tab ${l==="team"?"active":""}`,onClick:()=>x("team"),children:[t.jsx(O,{size:18}),t.jsx("span",{children:a("chat.team")})]})]}),t.jsxs("div",{className:"messages-container",children:[f.map(e=>t.jsxs("div",{className:`message ${e.sender==="user"?"message-user":"message-other"}`,children:[e.sender==="other"&&e.senderName&&t.jsx("div",{className:"message-sender",children:e.senderName}),e.imageUrl&&t.jsx("img",{src:e.imageUrl,alt:"Uploaded",className:"message-image"}),e.text&&t.jsx("div",{className:"message-text",children:e.text}),t.jsx("div",{className:"message-time",children:H(e.timestamp)})]},e.id)),t.jsx("div",{ref:N})]}),t.jsxs("div",{className:"chat-input-container",children:[t.jsx("button",{type:"button",className:"chat-action-button",onClick:()=>y.current?.click(),disabled:m,title:a("chat.uploadImage"),children:t.jsx(A,{size:20})}),t.jsx("button",{type:"button",className:"chat-action-button",onClick:U,disabled:m,title:a("chat.takePhoto"),children:t.jsx($,{size:20})}),t.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:I,style:{display:"none"}}),t.jsx("input",{type:"text",value:d,onChange:e=>v(e.target.value),onKeyPress:S,placeholder:a("chat.messagePlaceholder"),className:"chat-input",disabled:m,onFocus:R,onBlur:T}),t.jsx("button",{type:"button",className:"chat-send-button",onClick:w,disabled:!d.trim()||m,children:t.jsx(z,{size:20})})]})]}),C&&t.jsx("div",{className:"camera-modal",role:"dialog","aria-modal":"true",children:t.jsxs("div",{className:"camera-modal-content",children:[t.jsx("h2",{children:a("chat.cameraModalTitle")}),t.jsx("p",{children:a("chat.cameraModalDescription")}),t.jsx("video",{ref:n,playsInline:!0,autoPlay:!0,className:"camera-video"}),t.jsxs("div",{className:"camera-modal-actions",children:[t.jsx("button",{type:"button",onClick:D,children:a("chat.cameraCancel")}),t.jsx("button",{type:"button",onClick:E,children:a("chat.cameraCapture")})]})]})})]})}export{V as default};

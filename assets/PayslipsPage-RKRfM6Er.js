import{c as A,u as $,r as n,j as e,F as U,_ as Z}from"./index-D6UMoWAp.js";/* empty css                   */import{C as B}from"./clock-BpffiPDW.js";const Y=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],q=A("download",Y),G=[{monthOffset:-4,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-4,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:-3,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-3,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:-2,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-2,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:-1,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:-1,type:"timesheet",document:"stundennachweis.pdf"},{monthOffset:0,type:"payslip",document:"Beispiel-Lohnabrechnung.pdf"},{monthOffset:0,type:"timesheet",document:"stundennachweis.pdf"}],H={payslips:G},J=s=>{const p=new Date;return new Date(p.getFullYear(),p.getMonth()+s,1)};function ee(){const{t:s}=$("app"),p=n.useMemo(()=>H.payslips.map(a=>({date:J(a.monthOffset).toISOString().split("T")[0],type:a.type,document:a.document})),[]),P=t=>{const a=new Date(t),o=a.getDate().toString().padStart(2,"0"),f=(a.getMonth()+1).toString().padStart(2,"0"),D=a.getFullYear();return`${o}.${f}.${D}`},L=t=>s(t==="payslip"?"payslips.payslip":"payslips.timesheet"),W=t=>`/toepfer-pwa-prototyp/${t}`,[l,k]=n.useState(null),[O,S]=n.useState(!1),[x,C]=n.useState(null),[u,c]=n.useState(1),[E,w]=n.useState([]),[j,i]=n.useState(!0),v=n.useRef(null),m=n.useRef(null),h=n.useRef(0);n.useEffect(()=>{(async()=>{if(!l){w([]),i(!0),c(1);return}console.log("ðŸ”„ PDF Render Start - scale:",u,"autoFitWidth:",j);const a=++h.current;C(null),S(!0),w([]);try{const o=W(l),f=await Z(()=>import("./pdf-Dv71ODxn.js"),[]);f.GlobalWorkerOptions.workerSrc=new URL("/toepfer-pwa-prototyp/assets/pdf.worker.min-Cpi8b8z3.mjs",import.meta.url).toString();const N=await f.getDocument(o).promise;if(a!==h.current)return;const T=N.numPages,F=[];let r=u;if(j&&v.current){const g=(await N.getPage(1)).getViewport({scale:1}),d=v.current.clientWidth;r=Math.max(.3,Math.min(3,d/g.width)),console.log("ðŸ“ Auto-Fit-Width calculated:",r,"containerWidth:",d),i(!1),Math.abs(r-u)>.01&&c(r)}else console.log("ðŸŽ¯ Using manual scale:",r);for(let y=1;y<=T;y++){const g=await N.getPage(y),d=g.getViewport({scale:r}),b=document.createElement("canvas");b.width=d.width,b.height=d.height;const M=b.getContext("2d");if(!M)throw new Error("Canvas context not available");const V={canvasContext:M,viewport:d};await g.render(V).promise,F.push(b.toDataURL())}a===h.current&&w(F)}catch(o){console.error("PDF render error",o),C(s("payslips.loadError"))}finally{a===h.current&&S(!1)}})()},[l,u,j,s]),n.useEffect(()=>{const t=document.querySelector('meta[name="viewport"]');if(l){if(t){m.current=t.getAttribute("content");const o=(m.current||"width=device-width, initial-scale=1.0").replace(/user-scalable=no,?\s*/i,"").replace(/maximum-scale=1\.0,?\s*/i,"")+", maximum-scale=5.0, user-scalable=yes";t.setAttribute("content",o)}}else t&&m.current&&t.setAttribute("content",m.current)},[l]);const R=()=>{console.log("ðŸ” Zoom In clicked"),i(!1),c(t=>{const a=t*1.15;return console.log("âž• Zoom In: old scale:",t,"new scale:",a),a})},_=()=>{console.log("ðŸ” Zoom Out clicked"),i(!1),c(t=>{const a=Math.max(.2,t/1.15);return console.log("âž– Zoom Out: old scale:",t,"new scale:",a),a})},z=()=>{console.log("ðŸ“ Fit Width clicked"),i(!0),c(1)},I=()=>{console.log("ðŸ“„ Fit Page clicked"),i(!1),c(.9)};return e.jsxs("div",{className:"page-container",children:[e.jsx("header",{className:"page-header",children:e.jsx("h1",{className:"page-title",children:s("payslips.title")})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:s("payslips.date")}),e.jsx("th",{children:s("payslips.description")}),e.jsx("th",{children:s("payslips.document")})]})}),e.jsx("tbody",{children:p.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"date-cell",children:P(t.date)}),e.jsx("td",{className:"description-cell",children:e.jsxs("div",{className:"description-with-icon",children:[t.type==="payslip"?e.jsx(U,{size:18,className:"file-icon"}):e.jsx(B,{size:18,className:"file-icon"}),e.jsx("span",{children:L(t.type)})]})}),e.jsx("td",{className:"document-cell",children:e.jsxs("button",{type:"button",className:"download-button","aria-label":s("payslips.open"),onClick:()=>k(t.document),children:[e.jsx(q,{size:18}),e.jsx("span",{className:"download-text",children:s("payslips.open")})]})})]},a))})]})}),l&&e.jsxs("div",{className:"pdf-overlay",role:"dialog","aria-modal":"true",children:[e.jsxs("div",{className:"pdf-toolbar",children:[e.jsx("span",{className:"pdf-title",children:s("payslips.documentViewerTitle")}),e.jsxs("div",{className:"pdf-controls","aria-label":"PDF controls",children:[e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:_,"aria-label":s("payslips.zoomOut"),children:s("payslips.zoomOut")}),e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:R,"aria-label":s("payslips.zoomIn"),children:s("payslips.zoomIn")}),e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:z,"aria-label":s("payslips.fitWidth"),children:s("payslips.fitWidth")}),e.jsx("button",{type:"button",className:"pdf-control-btn",onClick:I,"aria-label":s("payslips.fitPage"),children:s("payslips.fitPage")}),e.jsx("button",{type:"button",className:"pdf-close-button","aria-label":s("payslips.closeDocument"),onClick:()=>k(null),children:s("payslips.closeDocument")})]})]}),e.jsxs("div",{className:"pdf-frame-wrapper",ref:v,children:[O&&e.jsx("div",{className:"pdf-status",children:s("payslips.loading")}),x&&e.jsx("div",{className:"pdf-error",children:x}),!O&&!x&&E.map((t,a)=>e.jsx("img",{src:t,alt:`${s("payslips.documentViewerTitle")} - Page ${a+1}`,style:{display:"block",margin:"0 auto 1rem"}},a))]})]})]})}export{ee as default};
